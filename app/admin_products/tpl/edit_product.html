<script src="/assets/js/libs/jquery3.5.1/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="/assets/js/libs/jquery3.5.1/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

<link rel="stylesheet" href="/assets/js/libs/bootstrap/bootstrap.min.css">
<script src="/assets/js/libs/bootstrap/bootstrap.min.js"></script>

<link href="/assets/js/libs/summernote/summernote.min.css" rel="stylesheet">
<script src="/assets/js/libs/summernote/summernote.min.js"></script>

<script>
    function changeProductStatus(itemId, status, statusType) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/change_product_status") ?>',
            data: {itemId, status, statusType},
            type: 'POST',
            success: function(data){
                if(data.success){
                    location.reload()
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    function setMaxWeight(itemId){
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/set_max_product_weight") ?>',
            data: {itemId},
            type: 'POST',
            success: function(data){
                if(data.success){
                    Swal.fire(
                        'Успех',
                        'Продукт передвинут в начало категории',
                        'success'
                    )
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }
</script>

<br>
<div class="card">
    <div class="card-header" style="<?php echo $STATUS ? 'background: #E9FFE7;' : 'background: #FFE3E3;' ?>">
        Редактировать продукт: <b>{NEW_SKU} ({SKU})</b>
        <div style="float: right">
            <?php if($STATUS == 2): ?>
                <button type="button" onclick="changeProductStatus('{ITEM_ID}', 0)" class="btn btn-danger btn-sm mr-2">Отключить товар</a>
            <?php else: ?>
                <button type="button" onclick="changeProductStatus('{ITEM_ID}', 2)" class="btn btn-success btn-sm mr-2">Включить товар</a>
            <?php endif; ?>
            
            <?php if($DELETED == 1): ?>
                <button type="button" onclick="changeProductStatus('{ITEM_ID}', 0, 'delete')" class="btn btn-success btn-sm mr-2">Восстановить</a>
            <?php else: ?>
                <button type="button" onclick="changeProductStatus('{ITEM_ID}', 1, 'delete')" class="btn btn-danger btn-sm mr-2">Удалить товар</a>
            <?php endif; ?>

            <?php if($SHIPPABLE == 1): ?>
                <button type="button" onclick="changeProductStatus('{ITEM_ID}', 0, 'shippable')" class="btn btn-success btn-sm">Только самовывоз</a>
            <?php else: ?>
                <button type="button" onclick="changeProductStatus('{ITEM_ID}', 1, 'shippable')" class="btn btn-danger btn-sm">Разрешить доставку</a>
            <?php endif; ?>

            <button type="button" class="btn btn-sm btn-primary ml-2" onclick="setMaxWeight('{ITEM_ID}')">В начало категории</button>
        </div>
    </div>
    <div class="card-body">
        <div class="mb-4">
            <div>Остаток на складе: <b>{STOCK}</b></div>
            <div>Забронированно: <b>{LOCKED_COUNT}</b></div>
            <div>Всего доступно: <b>{AVAILABLE}</b></div>
            <br>
            <form class="form-inline">
                <div class="form-check mr-3">
                    <input class="form-check-input" type="checkbox" id="hotProduct" <?php echo $HOT ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'hot', $(this).is(':checked'))">
                    <label class="form-check-label" for="hotProduct">
                        Популярный продукт
                    </label>
                </div>
                <div class="form-check mr-3">
                    <input class="form-check-input" type="checkbox" id="featuredProduct" <?php echo $FEATURED ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'featured', $(this).is(':checked'))">
                    <label class="form-check-label" for="featuredProduct">
                        Особый продукт
                    </label>
                </div>
                <div class="form-check mr-3">
                    <input class="form-check-input" type="checkbox" id="newProduct" <?php echo $NEW ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'new', $(this).is(':checked'))">
                    <label class="form-check-label" for="newProduct">
                        Новый продукт
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="saleProduct" <?php echo $SALE ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'sale', $(this).is(':checked'))">
                    <label class="form-check-label" for="saleProduct">
                        Снижена цена
                    </label>
                </div>
            </form>
        </div>

        <div class="mb-4">
            <form class="form-inline">
                <div class="form-check mr-3">
                    <input class="form-check-input" type="checkbox" id="e9" <?php echo $E9 ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'e9', $(this).is(':checked'))">
                    <label class="form-check-label" for="e9">
                        E9
                    </label>
                </div>
                <div class="form-check mr-3">
                    <input class="form-check-input" type="checkbox" id="e20" <?php echo $E20 ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'e20', $(this).is(':checked'))">
                    <label class="form-check-label" for="e20">
                        E20
                    </label>
                </div>
                <div class="form-check mr-3">
                    <input class="form-check-input" type="checkbox" id="ip68" <?php echo $IP68 ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'ip68', $(this).is(':checked'))">
                    <label class="form-check-label" for="ip68">
                        IP68
                    </label>
                </div>
                <div class="form-check mr-3">
                    <input class="form-check-input" type="checkbox" id="emc" <?php echo $EMC ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'emc', $(this).is(':checked'))">
                    <label class="form-check-label" for="emc">
                        EMC
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ece" <?php echo $ECE ? 'checked' : '' ?> onchange="flagCheckbox('{ITEM_ID}', 'ece', $(this).is(':checked'))">
                    <label class="form-check-label" for="ece">
                        ECE R65 TA1
                    </label>
                </div>
            </form>
        </div>

        <form id="categoryForm">
            <div>
                <input type="hidden" name="itemId" value="{ITEM_ID}">
                <div class="form-group">
                    <select name="category[]" multiple class="form-control" id="category" style="min-height: 300px;">
                        {CATEGORY_LIST}
                    </select>
                </div>
                <button type="button" onclick="saveCategoryes()" class="btn btn-sm btn-success">Save category</button>
            </div>
        </form>
        <br><br>

        <div>{LANGUAGE_BUTTONS}</div>
        <br>
        <div id="resultDiv"></div>
        
    </div>
</div>

<script>
    function saveCategoryes() {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/save_product_categories") ?>',
            data: $("#categoryForm").serialize(),
            type: 'POST',
            success: function(data){
                if(data.success){
                    location.reload();
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }
</script>

<br>
<div class="card">
    <div class="card-header">
        Атрибуты товара
    </div>
    <div class="card-body">
        <form id="productAttribute">
            <input type="hidden" name="itemId" value="{ITEM_ID}">
            <div class="row">
                <div class="col-sm-5">
                    <div class="form-group">
                        <select class="form-control" id="attribute" name="attrId" onchange="loadAttributeValues()">
                            {ATTRIBUTES}
                        </select>
                    </div>
                </div>
                <div class="col-sm-5" id="attributeValues"></div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-sm btn-primary" onclick="addProductAttribute()">Добавить</button>
                </div>
            </div>
        </form>
        <hr>
        <div>
            <table class="table table-bordered table-sm">
                {PRODUCT_ATTRIBUTES}
            </table>
        </div>
    </div>
</div>

<script>
    $(function(){
        loadAttributeValues();
    })

    function loadAttributeValues() {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/get_attribute_values") ?>',
            data: {attrId: $('#attribute').val()},
            type: 'POST',
            success: function(data){
                if(data.success){
                    $('#attributeValues').html(data.html);
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    function addProductAttribute() {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/add_product_attribute") ?>',
            data: $("#productAttribute").serialize(),
            type: 'POST',
            success: function(data){
                if(data.success){
                    location.reload();
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    function deleteAttribute(itemId, attrId) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/delete_product_attribute") ?>',
            data: {itemId, attrId},
            type: 'POST',
            success: function(data){
                if(data.success){
                    location.reload();
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }
</script>

<br>
<div class="card">
    <div class="card-header">
        Фотографии товара
    </div>
    <div class="card-body">

        <form class="form-inline mb-3" id="fileUploadForm">
            <input type="hidden" name="itemId" value="{ITEM_ID}">
            <div class="input-group mr-sm-2">
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileUpload" name="file" required>
                    <label class="custom-file-label" for="fileUpload">Choose file...</label>
                </div>
            </div>
            <button type="button" class="btn btn-primary" onclick="uploadFile()">Загрузить фото</button>
        </form>

        <div class="row" id="productImages">
            {PRODUCT_IMAGES}
        </div>

        <div class="card" style="border-left: 5px solid #539A48;">
            <div class="card-body">
                <form>
                    <div>Копировать картинки в товар | {NEW_SKU} ({SKU})</div>
                    <br>
                    <input type="text" class="form-control" id="originalSku" name="sku" required placeholder="SKU" onchange="loadProducts(this)">
        
                    <!-- <button type="button" class="btn btn-primary" onclick="copyImages()">Копировать картинки</button> -->
                </form>

                <br>
                <table class="table table-sm table-bordered">
                    <tbody id="productListCopy"></tbody>
                </table>
            </div>
        </div>

        
    </div>
</div>

<br>
<div class="card">
    <div class="card-header">
        Прикрепленные файлы
    </div>
    <div class="card-body">

        <form class="form-inline mb-3" id="fileUploadForm2">
            <input type="hidden" name="itemId" value="{ITEM_ID}">
            <div class="input-group mr-sm-2">
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileUpload2" name="file" required>
                    <label class="custom-file-label" for="fileUpload2">Choose file...</label>
                </div>
            </div>
            <button type="button" class="btn btn-primary" onclick="uploadFile2()">Загрузить файл</button>
        </form>

        <div class="row" id="productFiles">
            {PRODUCT_FILES}
        </div>
    </div>
</div>

<br>
<div class="card">
    <div class="card-header">
        Связанные товары
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-sm-12 mb-5">
                <div class="card" style="border-left: 5px solid #539A48;">
                    <div class="card-body">
                        <form id="similarForm">
                            <div>
                                {NEW_SKU} ({SKU})
                            </div>
                            <br>
                            <div class="form-group">
                                <input type="hidden" name="itemId" value="{ORIGINAL_ITEM_ID}">
                                <input type="text" id="skuSimilar" class="form-control" name="sku" placeholder="Article" onblur="getSimilar()">
                            </div>
                            <table class="table table-bordered table-sm">
                                <tbody id="similar"></tbody>
                            </table>
                            
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-sm-12">
                <table class="table table-bordered table-sm">
                    <tr style="font-weight: bold">
                        <td>ID</td>
                        <td>Артикуль</td>
                        <td>Артикуль (оригинальный)</td>
                        <td>Цена</td>
                        <td></td>
                    </tr>
                    {RELATED_PRODUCTS}
                </table>
            </div>            
        </div>
    </div>
</div>

<br>
<div class="card">
    <div class="card-header">
        Дополнительные артикули
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-sm-8">
                <form onsubmit="addArticle(this)">
                    <div class="form-group">
                        <input type="hidden" name="itemId" value="{ORIGINAL_ITEM_ID}">
                        <input type="text" class="form-control" name="sku" placeholder="Article">
                    </div>
                    <button type="submit" class="btn btn-sm btn-success">Добавить</button>
                </form>
            </div>
            <div class="col-sm-4">
                <table class="table table-bordered table-sm">
                    <thead>
                        <th>Ариткуль</th>
                        <th></th>
                    </thead>
                    <tbody>
                        {ADDITIONAL_SKU_ROW}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<br><br>

<script>

    function addArticle(form) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/add_additional_sku") ?>',
            data: $(form).serialize(),
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                preloader.off();
                if(data.success){
                    location.reload();
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }
    
    function removeAdditionalSku(sku) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/remove_additional_sku") ?>',
            data: {
                itemId: '{ITEM_ID}',
                sku: sku
            },
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                preloader.off();
                if(data.success){
                    location.reload();
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    function loadProducts() {

        let sku = $("#originalSku").val();
        if(sku.length < 3){
            return false;
        }

        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/load_products_for_copy") ?>',
            data: {sku, itemId: '{ITEM_ID}'},
            type: 'POST',
            beforeSend: function() {
                preloader.on();
                $('#productListCopy').html('');
            },
            success: function(data){
                preloader.off();
                if(data.success){
                    $('#productListCopy').html(data.html);
                }
            }
        });
    }

    function flagCheckbox(itemId, flag, value) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/set_flag") ?>',
            data: {itemId, flag, value},
            type: 'POST',
            success: function(data){
                if(data.success){
                    
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    openProductInfo('{ITEM_ID}', 'lv');

    function openProductInfo(itemId, lang) {
        $('#resultDiv').html('');

        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/get_product_by_lang") ?>',
            data: {itemId: itemId, lang: lang},
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function (data) {
                preloader.off();
                if (data.success) {
                    $('#resultDiv').html(data.html);
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        })
    }

    function getSimilar() {
        if(!$('#skuSimilar').val()){
            $('#similar').html('');
            return false;
        }
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/get_similar") ?>',
            data: $('#similarForm').serialize(),
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                preloader.off();
                if(data.success){
                    $("#similar").html(data.html);
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    function addRelation(original, related) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/add_relation") ?>',
            data: {original: original, related: related},
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                preloader.off();
                if(data.success){
                    Swal.fire(
                        'Отлично',
                        'Ваши изменения сохранены!',
                        'success'
                    )
                    getSimilar()
                } else {
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }
    
    function deleteRelation(original, related) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/delete_relation") ?>',
            data: {original: original, related: related},
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                if(data.success){
                    location.reload();
                } else {
                    preloader.off();
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    function setAsMain(itemId, fileId) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/set_main_image") ?>',
            data: {itemId, fileId},
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                if(data.success){
                    location.reload();
                } else {
                    preloader.off();
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }
    
    function deleteImage(itemId, fileId) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/delete_image") ?>',
            data: {itemId, fileId},
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                if(data.success){
                    location.reload();
                } else {
                    preloader.off();
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    $(function(){
        $("#productImages").sortable({
            ghostClass: "dropPlaceholder",
            onSort: function() {
                onDrop();
            }
        });
    });

    function onDrop() {
        var weight = 10;
        $('#productImages .imageCard').each(function() {
            $(this).attr('data-order', weight);
            weight += 10;
        });

        var data = {};
        data['itemId'] = '{ITEM_ID}';
        data['sort'] = [];

        $('#productImages .imageCard').each(function() {
            data['sort'].push($(this).attr('data-fileId'));
        });

        savePageBlocks(data);
    }

    function savePageBlocks(blockData) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/pages/sort_images") ?>',
            data: blockData,
            type: 'POST',
            dataType: 'JSON',
            success: function(data){
                if(data.success){
                    loadLeftSideBlocks();
                } else {
                    alert("Error (Code: " + data.error + ")");
                }
            }
        });
    }

    function uploadFile() {
        preloader.on();
        var formData = new FormData($("#fileUploadForm")[0]);
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/pages/upload_product_image") ?>',
            type: 'POST',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            enctype: 'multipart/form-data',
            processData: false,
           
            success: function (data) {
                if(data.success){
                    location.reload();
                } else {
                    preloader.off();
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }
    
    function uploadFile2() {
        preloader.on();
        var formData = new FormData($("#fileUploadForm2")[0]);
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/pages/upload_product_files") ?>',
            type: 'POST',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            enctype: 'multipart/form-data',
            processData: false,
           
            success: function (data) {
                if(data.success){
                    location.reload();
                } else {
                    preloader.off();
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

    function copyImages(itemId, targetItemId) {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/copy_images") ?>',
            data: {itemId, targetItemId},
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                preloader.off();
                if(data.success){
                    loadProducts();
                    Swal.fire({
                        icon: 'success',
                        title: 'Скопированно успешно',
                        showConfirmButton: false,
                        timer: 1500
                    })
                } else{
                    Swal.fire(
                        'Ошибка',
                        'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                        'error'
                    )
                }
            }
        });
    }

</script>

<style>
    .dropPlaceholder{
        background: #C5D3FF;
        border: 1px dashed #1c3faa;
    }

    .dropPlaceholder .card{
        background-color: transparent;
        border: none;
    }
</style>

<!-- [related_products] -->
<tr>
    <td>{ITEM_ID}</td>
    <td>{NEW_SKU}</td>
    <td>{SKU}</td>
    <td>{STANDART_PRICE}</td>
    <td>
        <button type="button" class="btn btn-danger btn-sm" onclick="deleteRelation('{ORIGINAL_ITEM_ID}', '{RELATED_ITEM_ID}')">Удалить связь</button>
    </td>
</tr>

<!-- [similar] -->
<tr>
    <td style="word-break: break-all;">{NEW_SKU} ({SKU})</td>
    <td>
        <button type="button" class="btn btn-success btn-sm" onclick="addRelation('{ORIGINAL_ITEM_ID}', '{RELATED_ITEM_ID}')">Связать</button>
    </td>
</tr>

<!-- [product_info] -->

<div class="card" style="border-left: 5px solid #007bff;">
    <div class="card-body">
        <form id="productForm">
            <input type="hidden" name="itemId" value="{ITEM_ID}">
            <input type="hidden" name="lang" value="{LANGUAGE}">
        
            <div class="form-group mx-sm-3 mb-2">
                <label>Язык</label>
                <input type="text" class="form-control" disabled value="{LANGUAGE}">
            </div>
        
            <div class="row">
                <div class="col-sm-3">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Цена без PVN</label>
                        <input type="text" name="price" class="form-control" value="{STANDART_PRICE}">
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Цена с PVN</label>
                        <input type="text" name="price" disabled class="form-control" value="{STANDART_PRICE_WITH_VAT}">
                    </div>
                </div>


                <div class="col-sm-3">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Новая цена без PVN</label>
                        <input type="text" name="discountPrice" class="form-control" value="{DISCOUNT_PRICE}">
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Новая цена с PVN</label>
                        <input type="text" name="discountPrice" disabled class="form-control" value="{DISCOUNT_PRICE_WITH_VAT}">
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Название товара</label>
                        <input type="text" name="title" class="form-control" value="{TITLE}">
                    </div>
                </div>
            </div>
        
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Артикуль (Оригинальный)</label>
                        <input type="text" name="sku" class="form-control" value="{SKU}">
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Артикуль (На сайте)</label>
                        <input type="text" name="newSku" class="form-control" value="{NEW_SKU}">
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Остаток</label>
                        <input type="text" name="stock" class="form-control" value="{STOCK}">
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Вес</label>
                        <input type="text" name="weight" class="form-control" value="{WEIGHT}">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-sm-4">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Длина</label>
                        <input type="text" name="length" class="form-control" value="{LENGTH}">
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Ширина</label>
                        <input type="text" name="width" class="form-control" value="{WIDTH}">
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group mx-sm-3 mb-2">
                        <label>Высота</label>
                        <input type="text" name="height" class="form-control" value="{HEIGHT}">
                    </div>
                </div>
            </div>
            
        
            <div class="form-group mx-sm-3 mb-2">
                <label>Описание короткое</label>
                <textarea name="shortDescr" class="form-control" id="editor" cols="30" rows="10">{SHORT_DESCR}</textarea>
            </div>
        
            <div class="form-group mx-sm-3 mb-2">
                <label>Описание полное</label>
                <textarea name="descr" class="form-control" id="editor2" cols="30" rows="10">{DESCR}</textarea>
            </div>
        
            <br>
            <div class="form-group mx-sm-3 mb-2">
                <button type="button" class="btn btn-success mb-2" onclick="saveProduct()">Сохранить</button>
            </div>
        </form>
    </div>
</div>



<script>
    function saveProduct() {
        $.ajax({
            url: '<?php echo $this->urlFor("ajax/admin_products/save_product") ?>',
            data: $('#productForm').serialize(),
            type: 'POST',
            beforeSend: function() {
                preloader.on();
            },
            success: function(data){
                preloader.off();
                if(data.success){
                    openProductInfo('{ITEM_ID}', '{LANGUAGE}');
                    Swal.fire(
                        'Отлично',
                        'Ваши изменения сохранены!',
                        'success'
                    )
                } else {
                    switch (data.error) {
                        case 2:
                            Swal.fire(
                                'Ой, обратите внимание',
                                'Нет никаких изменений!',
                                'warning'
                            )
                            break;
                    
                        default:
                            Swal.fire(
                                'Ошибка',
                                'Что-то пошло не так! (Код ошибки: ' + data.error + ')',
                                'error'
                            )
                            break;
                    }
                }
            }
        })
    }
</script>

<script>
    $(document).ready(function() {
        $('#editor').summernote({
            height: 300,
            toolbar: [
                ['style', ['bold', 'italic', 'underline', 'clear']],
                ['table', ['table']],
                ['font', ['strikethrough']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['height', ['height']],
                ['insert', ['link']],
                ['view', ['fullscreen', 'codeview', 'help']],
            ]
        });
        $('#editor2').summernote({
            height: 300,
            toolbar: [
                ['style', ['bold', 'italic', 'underline', 'clear']],
                ['table', ['table']],
                ['font', ['strikethrough']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['height', ['height']],
                ['insert', ['link']],
                ['view', ['fullscreen', 'codeview', 'help']],
            ]
        });
    });
</script>

<!-- [language_button] -->
<button type="button" class="btn btn-primary" onclick="openProductInfo('{ITEM_ID}', '{LANG_CODE}')">{LANG_TITLE}</button>

<!-- [product_images] -->
<div class="col-sm-3 mb-3 imageCard" data-fileId="{FILE_ID}">
    <div class="card">
        <div class="card-body">
            <div class="mb-2">{SIZE_EXIST}</div>
            <img src="{IMAGE_LINK}" alt="" style="max-width: 100%; max-height: 100%;">
            <div class="mt-2">
                <button type="button" onclick="setAsMain('{ITEM_ID}', '{FILE_ID}')" class="btn btn-sm btn-primary">Главная</button>
                <button type="button" onclick="deleteImage('{ITEM_ID}', '{FILE_ID}')" class="btn btn-sm btn-danger">Удалить</button>
            </div>
        </div>
    </div>
</div>

<!-- [product_files] -->
<div class="col-sm-3 mb-3 imageCard">
    <div class="card">
        <div class="card-body">
            <div>{FILE_NAME}</div>
            <div class="mt-2">
                <a href="{FILE}" class="btn btn-sm btn-primary">Посмотреть</a>
                <button type="button" onclick="deleteImage('{ITEM_ID}', '{FILE_ID}')" class="btn btn-sm btn-danger">Удалить</button>
            </div>
        </div>
    </div>
</div>

<!-- [size_exist] -->
<span class="badge bg-success text-light">{SIZE}</span>

<!-- [select] -->
<select class="form-control" name="valId">
    {ATTRIBUTE_VALUES}
</select>

<!-- [product_attributes] -->
<tr>
    <td>{ATTR_NAME}</td>
    <td>{VALUE}</td>
    <td>
        <button type="button" class="btn btn-sm btn-danger" onclick="deleteAttribute('{ITEM_ID}', '{ATTR_ID}')">Удалить</button>
    </td>
</tr>

<!-- [optgroup] -->
<optgroup label="{TITLE}">
    {OPTIONS}
</optgroup>

<!-- [option] -->
<?php if($SELECTED): ?>
    <option value="{VALUE}" selected style="color: green; font-weight: bold;">{NAME}</option>
<?php else: ?>
    <option value="{VALUE}">{NAME}</option>
<?php endif; ?>

<!-- [copy_list_item] -->
<tr>
    <td style="word-break: break-all;">{ITEM_ID} | {NEW_SKU} ({SKU})</td>
    <td>Фото в товаре: {COUNT}</td>
    <td>
        <button type="button" class="btn btn-success btn-sm" onclick="copyImages('{ORIGINAL_ITEM_ID}', '{TARGET_ITEM_ID}')">Копировать все фото в этот товар</button>
    </td>
</tr>

<!-- [additional_sku_row] -->
<tr>
    <td>{ADDITIONAL_SKU}</td>
    <td>
        <button type="button" class="btn btn-sm btn-danger" onclick="removeAdditionalSku('{ADDITIONAL_SKU}')">Удалить</button>
    </td>
</tr>

<!-- [-] -->